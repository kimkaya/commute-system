# 🚀 출퇴근 관리 시스템 통합 가이드

## 📋 개요

이 가이드는 모든 플랫폼의 출퇴근 관리 앱들을 통합하여 일관된 사용 경험을 제공하기 위한 단계별 실행 방법입니다.

## 🏗️ 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                     통합 출퇴근 관리 시스템                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │   Windows   │  │   Mobile    │  │    Web      │          │
│  │ Admin App   │  │    App      │  │  Admin App  │          │
│  │ (Electron)  │  │(Capacitor)  │  │  (Browser)  │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
│          │               │               │                 │
│          └───────────────┼───────────────┘                 │
│                          │                                 │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │           통합 API 서버 (Port 4000)                      │ │
│  │  - 인증 관리        - 급여 계산                          │ │
│  │  - 직원 관리        - 컴플라이언스 체크                   │ │
│  │  - 출퇴근 기록       - 백업 관리                         │ │
│  │  - 스케줄 관리       - 보고서 생성                        │ │
│  └─────────────────────────────────────────────────────────┘ │
│                          │                                 │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │           MongoDB 데이터베이스                            │ │
│  │  - 통합된 스키마     - 감사 로그                          │ │
│  │  - 인덱스 최적화     - 백업 메타데이터                     │ │
│  │  - 데이터 검증       - 알림 관리                         │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 🔧 설치 및 설정

### 1. 환경 요구사항

- **Node.js**: v16.0 이상
- **MongoDB**: v4.4 이상
- **Windows**: 10 이상 (Electron 앱)
- **Android**: API 24 이상 (모바일 앱)
- **iOS**: 12.0 이상 (모바일 앱)

### 2. 프로젝트 구조

```
D:\xamp\htdocs\
├── unified-api/                 # 통합 API 서버
│   ├── server.js               # 메인 API 서버
│   ├── migrate-database.js     # 데이터베이스 마이그레이션
│   ├── integration-test.js     # 통합 테스트
│   ├── database-schema.json    # DB 스키마 정의
│   └── shared/                 # 공통 컴포넌트
│       ├── commute-client.js   # API 클라이언트
│       └── design-system.css   # 통합 디자인 시스템
├── CommuteAdmin/               # Windows 관리자 앱
│   ├── main.js                # Electron 메인
│   ├── api-client.js          # 통합 API 클라이언트
│   └── preload.js             # 업데이트된 preload
├── admin-web-app/             # 모바일/웹 앱
│   ├── server.js              # 업데이트된 서버
│   └── public/
│       ├── mobile-index.html  # 새 모바일 UI
│       └── index.html         # 기존 웹 UI
├── admin-app/                 # 기존 웹 관리자 앱
├── Commute/                   # 직원용 출퇴근 앱
└── .env                       # 환경 변수
```

## 🚀 실행 순서

### Step 1: 환경 변수 설정

`.env` 파일을 생성하고 다음 내용을 추가하세요:

```env
# MongoDB 연결
MONGO_URI=mongodb://localhost:27017
DB_NAME=commuteApp

# 보안
SESSION_SECRET=your-super-secret-session-key
SALT_ROUNDS=12

# API 설정
API_PORT=4000
MOBILE_PORT=3000
WEB_PORT=3002

# 백업 경로
BACKUP_PATH=D:\backup\commute

# 알림 설정 (선택사항)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
```

### Step 2: 데이터베이스 마이그레이션

```bash
# 통합 API 디렉토리로 이동
cd D:\xamp\htdocs\unified-api

# 의존성 설치
npm install express session bcrypt mongodb cors dotenv xlsx

# 데이터베이스 마이그레이션 실행
node migrate-database.js
```

예상 출력:
```
🚀 데이터베이스 마이그레이션 시작 (v1.0 → v2.0)
============================================================

📦 faces 컬렉션 마이그레이션 시작...
✅ faces 컬렉션: 15개 문서 업데이트 완료

📦 records 컬렉션 마이그레이션 시작...
✅ records 컬렉션: 234개 문서 업데이트 완료

📦 새 컬렉션 생성 시작...
✅ leave 컬렉션 생성 완료
✅ schedules 컬렉션 생성 완료

🎉 마이그레이션 완료!
```

### Step 3: 통합 API 서버 시작

```bash
# 통합 API 서버 실행
node server.js
```

예상 출력:
```
📱 통합 출퇴근 관리 API 서버가 http://localhost:4000에서 실행 중입니다.
🌐 외부 접근: http://192.168.x.x:4000
📋 API 정보: http://localhost:4000/api/info
💓 상태 확인: http://localhost:4000/api/health
MongoDB 연결 성공
```

### Step 4: 모바일/웹 앱 서버 시작

```bash
# 새 터미널에서
cd D:\xamp\htdocs\admin-web-app

# 의존성 설치 (처음 한 번만)
npm install

# 모바일 웹 앱 서버 실행
node server.js
```

예상 출력:
```
관리자 웹 앱이 http://localhost:3000에서 실행 중입니다.
외부 접근: http://192.168.219.189:3000
MongoDB 연결 성공
```

### Step 5: Windows 관리자 앱 실행

```bash
# 새 터미널에서
cd D:\xamp\htdocs\CommuteAdmin

# Electron 앱 실행
npm start

# 또는 빌드된 실행 파일 사용
출퇴근관리자.exe
```

### Step 6: 통합 테스트 실행

```bash
# 통합 API 디렉토리에서
cd D:\xamp\htdocs\unified-api

# 통합 테스트 실행
node integration-test.js
```

예상 출력:
```
🚀 통합 테스트 시작
============================================================

✅ [2025-01-25T10:00:00.000Z] API 서버 연결 passed (150ms)
✅ [2025-01-25T10:00:00.200Z] 관리자 로그인 passed (250ms)
✅ [2025-01-25T10:00:00.500Z] 직원 목록 조회 passed (100ms)
...

📊 테스트 결과 요약
============================================================
총 테스트: 12
성공: 12
실패: 0
성공률: 100%

🎉 모든 테스트가 성공했습니다!
```

## 📱 사용 방법

### Windows 관리자 앱
- **접속**: 바탕화면의 `출퇴근관리자.exe` 실행
- **로그인**: 기본 비밀번호 `admin1234`
- **주요 기능**:
  - 📊 급여 계산 및 세부 분석
  - 📈 컴플라이언스 체크
  - 💾 자동 백업 관리
  - 📋 상세 보고서 생성

### 모바일 앱 (Android/iOS/Web)
- **접속**: `http://localhost:3000` 또는 외부 IP
- **특징**:
  - 📱 모바일 최적화 UI
  - 📊 핵심 기능 집중
  - 🔄 실시간 동기화
  - 📴 오프라인 모드 지원

### 웹 관리자 앱
- **접속**: `http://localhost:3002`
- **용도**: 웹 브라우저에서 관리 작업

## 🔄 데이터 동기화

모든 앱은 통합 API를 통해 실시간으로 데이터를 동기화합니다:

1. **실시간 동기화**: API 변경 시 즉시 모든 앱에 반영
2. **오프라인 지원**: 네트워크 연결이 끊어져도 기본 작업 가능
3. **충돌 해결**: 동시 수정 시 자동 병합
4. **백업 및 복원**: 자동/수동 백업 지원

## 🎯 통일된 기능

### 모든 플랫폼에서 동일하게 제공:
- ✅ **인증 시스템**: 동일한 계정으로 모든 앱 접속
- ✅ **직원 관리**: 일관된 직원 정보 관리
- ✅ **출퇴근 기록**: 표준화된 기록 형식
- ✅ **급여 계산**: 통일된 급여 산정 방식
- ✅ **보고서**: 동일한 형식의 보고서 출력

### 플랫폼별 특화 기능:
- **Windows 앱**: 고급 분석, 컴플라이언스, 백업
- **모바일 앱**: 간편 조회, 빠른 액션
- **웹 앱**: 어디서나 접속 가능

## ⚙️ 설정 및 관리

### 시스템 설정
- 📧 **알림 설정**: 이메일, Slack 연동
- 🔒 **보안 설정**: 비밀번호 정책, 세션 관리
- ⏰ **근무 규칙**: 근무시간, 연장근무 정책
- 💾 **백업 설정**: 자동 백업 스케줄

### 사용자 권한
- **관리자**: 모든 기능 접근
- **직원**: 개인 정보만 조회 가능
- **시스템**: 자동 작업 수행

## 🔧 문제 해결

### 자주 발생하는 문제

1. **API 서버 연결 실패**
   ```bash
   # 서버 상태 확인
   curl http://localhost:4000/api/health
   
   # MongoDB 연결 확인
   mongo --eval "db.adminCommand('ping')"
   ```

2. **모바일 앱 접속 불가**
   - 방화벽 설정 확인
   - IP 주소 확인: `ipconfig`
   - 포트 3000 개방 확인

3. **데이터 동기화 문제**
   ```bash
   # 강제 동기화
   curl -X POST http://localhost:4000/api/sync
   ```

### 로그 확인
- **API 서버**: 콘솔 출력 확인
- **Windows 앱**: 개발자 도구 (Ctrl+Shift+I)
- **웹 앱**: 브라우저 콘솔 확인

## 📈 모니터링

### 성능 지표
- **응답 시간**: < 300ms (목표)
- **동시 사용자**: 최대 100명
- **데이터베이스**: MongoDB 성능 모니터링

### 알림 설정
```javascript
// 알림 규칙 예제
{
  "overtimeWarning": "주 52시간 초과 시",
  "backupCompleted": "백업 완료 시", 
  "systemError": "시스템 오류 발생 시"
}
```

## 🔒 보안

### 데이터 보호
- **암호화**: bcrypt 비밀번호 해시
- **세션 관리**: 안전한 세션 토큰
- **입력 검증**: SQL 인젝션 방지
- **개인정보**: 얼굴 데이터 암호화 저장

### 접근 제어
- **IP 제한**: 허용된 IP만 접속 가능
- **계정 잠금**: 5회 로그인 실패 시 30분 잠금
- **세션 타임아웃**: 24시간 후 자동 로그아웃

## 📋 유지보수

### 정기 작업
- **일일**: 자동 백업 (오전 2시)
- **주간**: 컴플라이언스 체크
- **월간**: 급여 계산 배치 작업

### 업데이트
```bash
# API 서버 업데이트
git pull origin main
npm install
node migrate-database.js  # 필요시
pm2 restart commute-api

# Windows 앱 업데이트
npm run build  # 새 exe 파일 배포
```

## 🎉 완료!

축하합니다! 모든 플랫폼의 출퇴근 관리 앱이 성공적으로 통합되었습니다.

### 다음 단계
1. 실제 운영 환경에 배포
2. 사용자 교육 및 피드백 수집
3. 성능 최적화 및 기능 개선

### 지원
- 📧 기술 지원: tech-support@company.com
- 📖 문서: http://docs.commute-app.com
- 🐛 버그 리포트: GitHub Issues

**즐거운 출퇴근 관리 되세요! 🎯**